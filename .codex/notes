- 现有 REST 接口（docs/orchestrator-service.md）：`/api/v1/plans/validate`（dry-run）、`/api/v1/plans/execute`（启动执行）、`/api/v1/executions` 列表/详情、`/api/v1/status` 健康检查，均未启用鉴权；错误码已定义但无 token 校验实现。新增 gap 任务：`b5b97c1c`（停止执行，已由 `3efd8e7f` 补足）、`e2d58c9f`（logs.appended 实际广播 — 已完成）、`d1b3b2fd`（metrics.update 实际广播 — 已完成）。
- 自动化替代：`npm run ops -- auto --plan <file>` 提供校验/执行示例，README/文档已指向；CLI 启动输出迁移提示并写入日志。
- WebSocket Hub `/ws` 支持主题订阅（runtime/execution/bridge/approvals/metrics/system），客户端可发送 subscribe/unsubscribe 指令；当前未限制来源，也未记录订阅者身份。
- OrchestratorController 执行路径：Plan Schema 校验、自动注册 agents、可选 mock MCP；执行期使用 JsonCheckpointStore、ApprovalController（JSON 存储）、统一日志输出，并通过事件 emitter 推送 runtime/execution/approval/bridge 状态。
- MCP Bridge 客户端默认使用 Streamable HTTP（@modelcontextprotocol/sdk），可注入 transportFactory 以支持 StdIO；具备指数退避重连、bridge state 事件、会话持久化（FileBridgeSessionRegistry）；`useMockBridge` 开启时改用本地 mock。
- 日志与审批：Pino Facade 输出至单一 `logs/app.jsonl`，Tail/分析脚本可直接消费；审批请求写入 `state/approvals/pending.json`/`completed.json`，CLI/GUI 通过 ApprovalController 记录决策。
- 双栈现状：运行时默认 `useMockBridge=true`（StdIO 本地）；Orchestrator Service 允许提供 `mcpEndpoint` 切换 Streamable HTTP；尚未定义在不同部署环境下的选择规则与安全要求。

## 2025-10-12 平台工程最佳实践调研
- **Golden Path 定位**：行业实践强调以安全和自动化内建的统一工具链提升交付速度，并用成功率、周期时间、采用度等指标衡量路径成效。citeturn2search0turn2search2turn2search1
- **事件总线治理**：Kafka 等事件流系统建议持续监控 backlog/滞后与吞吐，设置阈值告警并在消费者侧实行背压策略，防止过载并保持稳定。citeturn3search1turn3search2
- **自动化与人工 fallback**：部署自动化需集成自动回滚流程，同时提前规划可触发的人工干预步骤与文档化 Runbook，减少故障恢复时间并避免临时手工操作。citeturn10search11turn10search5

## 参考资料（API/MCP 治理）
- MCP 2025-03-26 官方传输规范：定义 stdio 与 Streamable HTTP，要求客户端默认支持 stdio，并描述单端点 POST/GET、SSE 增强、会话管理及向后兼容 citeturn1search1
- MCP 2024-11 草案传输规范：指出早期 HTTP+SSE 设计与 stdio 要求，为追溯历史与兼容策略提供背景 citeturn1search0
- MCP 规范更新日志：强调 2025-06-18 之后对 Streamable HTTP 的安全要求（例如非法 Origin 返回 403） citeturn1search4
- MCP 授权草案：建议 HTTP 传输采用 OAuth2/OIDC，StdIO 从环境获取凭据，强调可选授权和传输级安全职责 citeturn1search6
- OpenAPI 设计与治理最佳实践：设计优先、单一事实来源、DRY、命名一致性等治理原则 citeturn0search0turn0search7
- OpenAPI 版本管理建议：说明多版本文档、清晰策略、语义化版本与弃用政策 citeturn0search1turn0search10turn0search2
- Declarative Governance（OpenAPI 嵌入策略、CI/CD Linting、审计）citeturn0search5

## Web UI / MCP 功能现状 (2025-10-10)
| 功能场景 | 现有实现 | 缺口/待迁移 | 备注 |
| --- | --- | --- | --- |
| Plan 列表/执行状态查看 | React 状态面板展示 `/executions`（ExecutionList） | 无 | 只读，刷新按钮触发 fetch |
| Plan 校验（dry-run） | Web UI PlanActions 已提供按钮，调用 `/plans/validate`；CLI `plan:dry-run` 仍可用 | MCP UI 待接入；需支持上传/Registry 引用 | 保留 warnings 展示与禁用逻辑 |
| Plan 执行（自动执行） | Web UI PlanActions 按钮调用 `/plans/execute`，断线自动禁用；CLI `run:auto` | MCP UI 待接入；需增加参数面板（计划选择/配置） | 需确保执行日志记录与恢复指引 |
| 审批决策 | Web UI PendingApprovals 提供通过/拒绝按钮与备注输入；CLI approvals 仍可用 | MCP UI 未实现；需添加批量/过滤 | 操作写入 audit/security 日志，后续支持历史导出 |
| Bridge 状态控制 | UI 有 BridgeStatus + 手动重连 | 功能基本满足 | 需提示授权/连接信息（治理要求） |
| 日志查看 | CLI `logs:tail` / scripts | UI 无实时日志面板 | 待事件总线/OTel 任务支撑 |
| Plan/Agent Registry 管理 | CLI registry:*、REST `/registry/*` | UI/MCP 无配置界面 | 关联后续 Registry/GitOps 任务 |
| MCP 工具调用 | BridgeSession 共享、CLI/Orchestrator 可调用 | UI 未暴露动作；MCP UI 扩展未开始 | 需等待 GUI 插件协议、插件运行时任务 |
| MCP 插件禁用策略 | gui-runtime-spec 约定断线禁用 | UI 未实现操作按钮，暂无插件位 | 倚赖 future tasks (`aa92a1fe` 等) |
| 日志/审批历史导出 | 无 UI 功能 | 需提供下载/过滤 | 依赖日志服务/审批查询 API |
| CLI 通知迁移 | README+CLI 提示 | UI 需增加提醒 | 结合 CLI 弱化计划 (`08b9ce23`) |

## 2025-10-10 UI 库决策
- 统一采用 **TailwindCSS + daisyUI + React Flow** 实现 Web UI；daisyUI 提供 MIT 免费主题与组件，适合快速搭建审批面板、表单和提示。
- Tailwind `preflight` 可能影响第三方样式，需在 `tailwind.config.js` 中评估是否关闭或配合 Emotion Cache 调整注入顺序。
- 建议建立 UI 封装层（如 `@/ui`），避免 daisyUI 类名散落业务组件；主题变量统一维护在 Tailwind 配置，便于宿主覆盖。
- 后续 Storybook/测试需验证主题一致性，并评估与未来插件协议、事件总线组件的结合方式。

## 2025-10-11 Operations Log 归档策略
- 主日志文件 `.codex/operations-log.md` 仅保留最近一个季度记录；季度结束时将历史记录移动至 `.codex/operations-log-YYYYQX.md` 并在主文件写入索引行。  
- 归档流程：1）复制现有表头；2）剪切旧记录至归档文件；3）在主日志新增“归档完成”行；4）更新本笔记与 `PLAN.md`/`TASKS.md`。  
- 新增归档文件时，请在 `docs/index.md` 与 README（如有日志章节）补充索引。  
- 若需要自动化脚本，可后续在 `scripts/` 目录新增 `operations-log-archive.ts`（待规划）。

## 2025-10-11 文档瘦身策略
- 将原《docs/library-alignment.md》合并入《docs/platform-overview.md》第 8 章，保留存根提示，后续库映射更新以平台总览为单一事实来源。  
- 已完成《docs/ui-migration-plan.md》《docs/gui-runtime-spec.md》整合，形成《docs/gui-handbook.md》，旧文档保留索引说明。  
- 已将 GUI 插件规范合并至《docs/gui-handbook.md》第 7 章，`gui-plugin-spec.md` 文件已移除；后续扩展直接在该章节维护，并记得同步 `docs/index.md` 与 `.codex/operations-log.md`。
- 原批量测试脚本及相关计划已彻底移除；如需批量验证，请按需编写新的自动化脚本并在 `.codex/testing.md` 记录结果。
- 2025-10-12：删除 `docs/ui-migration-plan.md`、`docs/gui-runtime-spec.md`、`docs/library-alignment.md`，所有内容已整合入《docs/gui-handbook.md》《docs/platform-overview.md》。

## 2025-10-12 平台工程最佳实践调研
- **Golden Path 定位**：行业实践强调提供自助、安全预设且具可度量指标的统一工具链，并结合 DORA 指标、任务完成率与开发者体验调查衡量路径成效。citeturn0search0turn0search6
- **事件总线治理**：Kafka 等事件流系统建议监控消费延迟、适度调节 `max.poll.records`/拉取批量，并按需扩容下游消费端以缓解背压。citeturn0search5
- **自动化与人工 fallback**：部署自动化需设定明确回滚窗口与条件化自动回退流程，同时保留 Runbook 供复杂情境时人工介入。citeturn0search3turn0search9
