
    if (node.type === "human_approval") {
      try {
        await ensureNodeApproval(node, ctx);
      } catch (error) {
        ctx.logger.error(`节点 ${node.id} 审批失败`, error, {
          nodeId: node.id,
          nodeType: node.type
        });
      const snapshotOutputs: Record<string, unknown> = state.outputs ?? {};
      await checkpointAfterNode(node.id, ctx, snapshotOutputs);
        return {
